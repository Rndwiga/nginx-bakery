server {
    listen 443;

        ssl on;
<?php if (!isset($CONFIG['certificates'][$BAKERY['_project_key']])) : ?>
        ssl_certificate <?php echo $CONFIG['certificates']['default']['crt']; ?>;
        ssl_certificate_key <?php echo $CONFIG['certificates']['default']['key']; ?>;
<?php else : ?>
        ssl_certificate <?php echo $CONFIG['certificates'][$BAKERY['_project_key']]['crt']; ?>;
        ssl_certificate_key <?php echo $CONFIG['certificates'][$BAKERY['_project_key']]['key']; ?>;
<?php endif; ?>

        # @see https://observatory.mozilla.org/analyze.html?host=www.kevinpapst.de
        # @see https://infosec.mozilla.org/guidelines/web_security#contributejson

        # Only connect to this site and subdomains via HTTPS for the next year and also include in the preload list
        #Strict-Transport-Security:Â max-age=31536000; includeSubDomains; preload
        add_header 'Strict-Transport-Security' 'max-age=31536000' always;

        # Block site from being framed with X-Frame-Options and CSP
        add_header 'X-Frame-Options' 'SAMEORIGIN';

        # Disable referrers for browsers that don't support strict-origin-when-cross-origin
        # Uses strict-origin-when-cross-origin for browsers that do
        add_header 'Referrer-Policy' 'no-referrer, strict-origin-when-cross-origin';

        # Block pages from loading when they detect reflected XSS attacks
        add_header "X-XSS-Protection" "1; mode=block";

        # Block site from being framed with X-Frame-Options and CSP
        add_header "Content-Security-Policy" "frame-ancestors 'none'; object-src 'none'; base-uri 'none';";
        #add_header "Content-Security-Policy" "default-src https: data: 'unsafe-eval' 'unsafe-inline'; frame-ancestors 'none'; ";
        #add_header 'Content-Security-Policy' 'default-src * unsafe-inline unsafe-eval; script-src *; style-src *; ing-src *; font-src *; connect-src *; media-src *; object-src *; child-src *; frame-src *; worker-src *; frame-ancestors *; form-action *; upgrade-insecure-requests; sandbox allow-forms allow-same-origin allow-scripts allow-top-navigation allow-popups allow-pointer-lock; reflected-css block; base-url thecustomizewindows.com:443; manifest-src *; referrer no-referrer-when-downgrade; require-sri-for script style';

        # Prevent browsers from incorrectly detecting non-scripts as scripts
        add_header "X-Content-Type-Options" "nosniff";

<?php echo nginx_bakery_render_server($BAKERY); ?>
}
